<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Réussite Étudiante - Babylon.js</title>

  <!-- Apex font -->
  <link href="https://fonts.googleapis.com/css2?family=Azeret+Mono:wght@500&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg-color: #00AFD7;
      --text-color: #fff;
      --accent-color: #ffffff;
      --font: 'Azeret Mono', monospace;
    }

    * {
      box-sizing: border-box;
    }

    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
      background-color: var(--bg-color);
      font-family: var(--font);
    }

    /* Canvas Babylon */
    #renderCanvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
    }

    /* Overlays */
    .label {
      position: absolute;
      color: var(--text-color);
      font-size: 24px;
      font-weight: 500;
      transform: translate(-50%, -50%);
      pointer-events: auto;
      z-index: 5;
      display: none;
      cursor: pointer;
      text-shadow: 1px 1px 5px #00000066;
    }

    /* Vidéo */
    #videoContainer {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      width: 45%;
      max-width: 720px;
      height: 25%;
      transform: translate(-50%, -50%);
      background: transparent;
      z-index: 10;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    #videoContainer iframe {
      width: 100%;
      height: calc(100% - 40px);
      border: none;
    }

    #backButton {
      width: 100%;
      height: 40px;
      background: white;
      color: black;
      font-weight: bold;
      border: none;
      cursor: pointer;
    }

    #backButton:hover {
      background: #e0e0e0;
    }

    /* Menu hamburger */
    .menu-button {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 99;
      width: 40px;
      height: 30px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      cursor: pointer;
    }

    .menu-button span {
      background: white;
      height: 4px;
      border-radius: 2px;
      transition: all 0.3s ease;
    }

    /* Menu overlay */
    .menu-overlay {
      position: fixed;
      top: 0;
      right: -100%;
      width: 300px;
      height: 100%;
      background: rgba(0, 0, 0, 0.95);
      color: white;
      z-index: 98;
      padding: 60px 20px;
      transition: right 0.4s ease;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .menu-overlay.open {
      right: 0;
    }

    .menu-overlay a {
      text-decoration: none;
      color: white;
      font-size: 18px;
      border-bottom: 1px solid #ffffff22;
      padding-bottom: 8px;
      transition: all 0.3s ease;
    }

    .menu-overlay a:hover {
      color: #00AFD7;
    }
  </style>
</head>
<body>

  <!-- Labels -->
  <div id="label1" class="label">socleetoiletoque</div>
  <div id="label2" class="label">agenda</div>
  <div id="label3" class="label">computer</div>
  <div id="label4" class="label">coffre</div>
  <div id="label5" class="label">livres</div>

  <!-- Canvas -->
  <canvas id="renderCanvas"></canvas>

  <!-- Video container -->
  <div id="videoContainer">
    <iframe id="videoFrame" allow="autoplay" allowfullscreen></iframe>
    <button id="backButton">Retour à la scène 3D</button>
  </div>

  <!-- Menu button -->
  <div class="menu-button" onclick="toggleMenu()">
    <span></span><span></span><span></span>
  </div>

  <!-- Menu overlay -->
  <div class="menu-overlay" id="menu">
    <a href="https://www.youtube.com/watch?v=Jgcb7hjdgaU" target="_blank">Socle Étoile Toque</a>
    <a href="https://www.youtube.com/embed/lUU1G-6klpI?autoplay=1" target="_blank">Agenda</a>
    <a href="https://www.youtube.com/embed/lUU1G-6klpI?autoplay=1" target="_blank">Computer</a>
    <a href="https://www.youtube.com/embed/lUU1G-6klpI?autoplay=1" target="_blank">Coffre</a>
    <a href="https://www.youtube.com/embed/lUU1G-6klpI?autoplay=1" target="_blank">Livres</a>
  </div>

  <!-- BabylonJS -->
  <script src="https://cdn.babylonjs.com/babylon.js"></script>
  <script src="https://cdn.babylonjs.com/loaders/babylon.glTF2FileLoader.js"></script>

  <script>
    const canvas = document.getElementById("renderCanvas");
    const engine = new BABYLON.Engine(canvas, true);
    const scene = new BABYLON.Scene(engine);
    scene.clearColor = new BABYLON.Color3.FromHexString("#00AFD7");

    const camera = new BABYLON.ArcRotateCamera("camera", Math.PI / 2, Math.PI / 2.5, 4, BABYLON.Vector3.Zero(), scene);
    camera.attachControl(canvas, true);

    const light = new BABYLON.HemisphericLight("light", new BABYLON.Vector3(0, 1, 0), scene);
    light.intensity = 1.1;

    const labels = [
      { id: 'label1', file: 'socleetoiletoque.glb' },
      { id: 'label2', file: 'agenda.glb' },
      { id: 'label3', file: 'computer.glb' },
      { id: 'label4', file: 'coffre.glb' },
      { id: 'label5', file: 'livres.glb' }
    ];

    const videoLinks = {
      label1: "https://www.youtube.com/watch?v=Jgcb7hjdgaU",
      label2: "https://www.youtube.com/embed/lUU1G-6klpI?autoplay=1",
      label3: "https://www.youtube.com/embed/lUU1G-6klpI?autoplay=1",
      label4: "https://www.youtube.com/embed/lUU1G-6klpI?autoplay=1",
      label5: "https://www.youtube.com/embed/lUU1G-6klpI?autoplay=1"
    };

    const videoContainer = document.getElementById("videoContainer");
    const videoFrame = document.getElementById("videoFrame");

    labels.forEach(({ id, file }) => {
      const label = document.getElementById(id);
      BABYLON.SceneLoader.Append("", file, scene, function (scene) {
        const mesh = scene.meshes[scene.meshes.length - 1];

        scene.registerAfterRender(() => {
          if (!mesh) return;
          const pos = mesh.getBoundingInfo().boundingSphere.centerWorld;
          const proj = BABYLON.Vector3.Project(pos, BABYLON.Matrix.Identity(), scene.getTransformMatrix(), camera.viewport.toGlobal(engine.getRenderWidth(), engine.getRenderHeight()));
          if (proj.z >= 0 && proj.z <= 1) {
            label.style.left = proj.x + "px";
            label.style.top = proj.y + "px";
            label.style.display = "block";
          } else {
            label.style.display = "none";
          }
        });

        label.addEventListener("click", () => {
          videoContainer.style.display = "flex";
          videoFrame.src = videoLinks[id];
        });
      });
    });

    document.getElementById("backButton").addEventListener("click", () => {
      videoContainer.style.display = "none";
      videoFrame.src = "";
    });

    window.addEventListener("resize", () => engine.resize());
    engine.runRenderLoop(() => scene.render());

    // Menu toggle
    function toggleMenu() {
      const menu = document.getElementById("menu");
      menu.classList.toggle("open");
    }
  </script>
</body>
</html>
