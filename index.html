<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Pôle Accompagnement à la Réussite étudiante</title>
  <style>
    body { margin: 0; overflow: hidden; background: #222; }
    #container { position: relative; width: 100vw; height: 100vh; }
    .circle-blink {
      position: absolute;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background: #ffeb3b;
      animation: blink 1s infinite;
      box-shadow: 0 0 8px #ffd700;
      pointer-events: auto;
      cursor: pointer;
    }
    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.2; }
    }
    .icon-hotspot {
      position: absolute;
      width: 60px;
      height: 60px;
      pointer-events: auto;
      cursor: pointer;
      /* For debugging: border: 1px solid #fff; */
    }
  </style>
</head>
<body>
  <div id="container"></div>
  <script type="module">
    import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.164.1/build/three.module.js';
    import { GLTFLoader } from 'https://cdn.jsdelivr.net/npm/three@0.164.1/examples/jsm/loaders/GLTFLoader.js';
    import { OrbitControls } from 'https://cdn.jsdelivr.net/npm/three@0.164.1/examples/jsm/controls/OrbitControls.js';

    const YOUTUBE_LINK = "https://www.youtube.com/watch?v=lUU1G-6klpI&list=PLV8G_tL0jD2JNU3NqxIcULusdtMWeKL5k&index=1";
    const ICONS = [
      { glb: "icone1.glb" }, // Remplacez par vos fichiers
      { glb: "icone2.glb" },
      { glb: "icone3.glb" },
      { glb: "icone4.glb" },
      { glb: "icone5.glb" },
      { glb: "icone6.glb" },
      { glb: "icone7.glb" },
    ];

    let camera, scene, renderer, controls;
    const container = document.getElementById('container');
    const loader = new GLTFLoader();

    // Initialisation de la scène 3D
    init();
    animate();

    function init() {
      scene = new THREE.Scene();
      camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
      camera.position.set(0, 0, 8);

      renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      container.appendChild(renderer.domElement);

      controls = new OrbitControls(camera, renderer.domElement);
      controls.enableZoom = false;
      controls.enablePan = false;
      controls.enableDamping = true;

      // Lumière
      scene.add(new THREE.AmbientLight(0xffffff, 1));
      let light = new THREE.DirectionalLight(0xffffff, 0.8);
      light.position.set(0, 5, 5);
      scene.add(light);

      // Élément central
      loader.load("background.glb", (gltf) => {
        gltf.scene.position.set(0, 0, 0);
        scene.add(gltf.scene);
      });

      // Icônes autour
      const radius = 3.5;
      ICONS.forEach((icon, i) => {
        const angle = (i / ICONS.length) * Math.PI * 2;
        const x = Math.cos(angle) * radius;
        const y = Math.sin(angle) * radius;
        loader.load(icon.glb, (gltf) => {
          gltf.scene.position.set(x, y, 0);
          gltf.scene.scale.set(0.6, 0.6, 0.6);
          scene.add(gltf.scene);

          // Hotspot HTML pour clic
          createHotspot(x, y, i);
        });
      });

      window.addEventListener('resize', onWindowResize, false);
    }

    function onWindowResize() {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
      updateHotspots();
    }

    function animate() {
      requestAnimationFrame(animate);
      controls.update();
      renderer.render(scene, camera);
      updateHotspots();
    }

    // Crée un hotspot HTML (icône + cercle clignotant)
    function createHotspot(x, y, idx) {
      // Position dans l'écran
      const hotspot = document.createElement('div');
      hotspot.className = 'icon-hotspot';
      hotspot.dataset.idx = idx;
      container.appendChild(hotspot);

      // Cercle clignotant (à côté de l'icône)
      const circle = document.createElement('div');
      circle.className = 'circle-blink';
      circle.dataset.idx = idx;
      container.appendChild(circle);

      // Gestion du clic
      function openYoutube() {
        const w = window.innerWidth / 2;
        const h = window.innerHeight / 2;
        const l = window.innerWidth / 4;
        const t = window.innerHeight / 4;
        window.open(
          YOUTUBE_LINK,
          "_blank",
          `width=${w},height=${h},left=${l},top=${t},resizable=yes,scrollbars=yes`
        );
      }
      hotspot.addEventListener('click', openYoutube);
      circle.addEventListener('click', openYoutube);

      // Stocker pour mise à jour de la position
      hotspot._pos = { x, y };
      circle._pos = { x: x + 0.6, y: y + 0.6 }; // Décalage du cercle
    }

    // Met à jour les positions des hotspots à chaque frame
    function updateHotspots() {
      const elements = container.querySelectorAll('.icon-hotspot, .circle-blink');
      elements.forEach(el => {
        if (!el._pos) return;
        // Convertit la position 3D -> 2D écran
        const vector = new THREE.Vector3(el._pos.x, el._pos.y, 0);
        vector.project(camera);
        const sx = (vector.x * 0.5 + 0.5) * window.innerWidth;
        const sy = (-vector.y * 0.5 + 0.5) * window.innerHeight;
        el.style.left = `${sx - (el.className === 'icon-hotspot' ? 30 : 15)}px`;
        el.style.top = `${sy - (el.className === 'icon-hotspot' ? 30 : 15)}px`;
      });
    }
  </script>
</body>
</html>
